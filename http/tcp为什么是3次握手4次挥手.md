# tcp为什么是3次握手4次挥手

## 3次握手

3次握手为了让客户端和服务器互相确认自己和对方都能双工连接，收发正常。

### 第1次握手

客户端发送一个包出去，服务器收到。

对于客户端：包有没有发成功不知道。

对于服务器：自己能正常收到包，但不知道自己能不能发成功，客户端能正常发包，能不能正常接收不知道。

### 第2次握手

服务器发送一个确认包，客户端收到。

对于客户端：自己收到了服务器返回的包，说明自己能正常发送也能正常接收，而对方也能正常接收和正常发送。

对于服务器：自己能正常接收，但发送能不能成功不知道，而客户端能正常发送，能不能正常接收还是不知道。

### 第3次握手

客户端收到服务器的确认包之后再发送一个响应包过去，服务端收到。

对于客户端：之前就确认了自己收发正常，服务器也收发正常。

对于服务器：收到客户端的响应，说明自己发送正常，接收也正常，客户端也能正常收发。

### 总结

3次握手之后，双发才都确认了对方能收发正常。

## 4次挥手

A发出FIN报文，表示这边发送结束，但还可以收，B收到之后肯定要响应，不然A不知道B有没有收到。这样就已经两次握手了。

B收到A发出的FIN报文，知道A结束发送，但B自己不一定已经准备好，B说不定本来还有数据要发给A，所以，B这边要等到数据发完了，再发一个FIN给A，表示B也发完了，A如果收到B发来的FIN，当然要响应。所以就有了4次挥手。

A发出最后的ACK之后，处于TIME_WAIT状态，因为A最后发出的ACK如果B没有收到，B还会再发一次FIN过来，A还要重传ACK。所以A发出TIME_WAIT之后，会等2MSL时间，就是两个MSL(Maximum Segment Lifetime)的时间，才最后结束。
