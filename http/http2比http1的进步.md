# http2 比 http1的进步

## http 1.0

每个资源必须重新连接，非常耗时和耗资源。

---

## http 1.1

- 长连接，一个连接多个请求
- 请求多了，容易有队头阻塞问题
- 添加并行tcp连接可以减轻这个问题，但增加了连接数。

---

## http 2 (本章主角)

### 多路复用技术

- 只用一个tpc连接
- 并行构建多个流
- 每个流包含多个请求/响应消息
- 每个消息分解成多个二进制帧元
- 二进制帧交错并行传输互不阻塞，到了另一端再组装起来

### 多路复用带来的好处

- 多流并行只用一个 TCP 连接
- 服务器连接减少，内存占用减少，连接吞吐加大，网络拥塞降低
- 单一TCP连接在TCP慢启动机制背景下更快提高传输速度
  - 多个TCP连接每一个都要经历慢启动，更多消息处于慢启动过程
  - 单一TCP连接让后续更多消息不需要度过慢启动初期过程

### 二进制分帧层（实现多路复用的关键技术）

- 所有http信息分装成更小的二进制帧
- 头部信息封装到 HEADER frame
- Body 封装到 DATA frame
- 采用HPACK压缩头部
  - Haffman编码
  - 跟踪发过的头部信息
  - 后续的头部只发送差异部分(很多静态资源头部几乎一样，可能就只有路径不同，头部只发不同的这一行就行)
  - http1没有对头部压缩

### 预测资源请求

- 服务器发送html文件时能知道里面依赖哪些JavaScript和css文件
- 服务器发一个帧告诉客户端可以继续推送这些文件
- 客户端如果有缓存可以拒绝